//# sourceMappingURL=reportRequest.js.map
var commentCounter=0,taskCounter=0,REPORT_REQUEST="";
$(document).ready(function(){function n(a){var b=pvr.common_util.preserve_line_break(a.description);return'<div style="margin-top: 5px;"><a href="javascript:void(0)" class="btn btn-xs btn-primary deleteNewLink" data-id="'+a.altId+'"><span class="fa fa-remove" title="'+$.i18n._("delete")+'"></span> </a><b>'+a.linkTypename+'</b> <span class="glyphicon glyphicon-arrow-right"></span><a href="show?id='+a.to+'" >'+a.toname+"</a> "+b+"</div>"}$(".select2-box").select2();commentCounter=$("#commentSize").val();
taskCounter=$("#actionItems").val();initializePastDatesNotAllowedDatePicker();$("#startDateDiv,#endDateDiv").datepicker({allowPastDates:!0,momentConfig:{format:DEFAULT_DATE_DISPLAY_FORMAT}}).on("changed.fu.datepicker inputParsingFailed.fu.datepicker dateClicked.fu.datepicker",function(a,b){start=$("#startDateDiv").datepicker("getDate");end=$("#endDateDiv").datepicker("getDate");$("#startDateDiv,#endDateDiv").removeClass("has-error");start&&end&&start>end&&$(this).addClass("has-error")});"create"==
$("#mode").val()?($(".date").val(""),$("#dueDateHidden").val()&&$("#dueDate").val($("#dueDateHidden").val())):($("#dueDate").val($("#dueDateHidden").val()),$("#completionDate").val($("#completionDateHidden").val()),$("#startDate").val($("#startDateHidden").val()),$("#endDate").val($("#endDateHidden").val()),$("#asOfVersionDate").val($("#asOfVersionDateHidden").val()));$(".add-comment").click(function(){l(null,null,commentCounter,!0)});$("#closeCommentModal").click(function(){$("#reportComment").val("")});
var l=function(a,b,d,f){var e=$("#reportCommentModal");e.modal("show");e.find("#index").val(d);e.find("#commentId").val(b);e.find("#newComment").val(f);a&&e.find("#reportComment").val(a);e.find(".creationButton").click(function(){var a=e.find("#reportComment").val(),b=e.find("#index").val(),d=e.find("#commentId").val(),c=e.find("#newComment").val(),a=encodeToHTML(a);""!=a&&null!=a&&(d?(document.getElementById("comments["+b+"].reportComment").value=a,document.getElementById("comments["+b+"].display").innerHTML=
pvr.common_util.preserve_line_break(a)):JSON.parse(c)?(q(a),commentCounter++):(document.getElementById("comments["+b+"].reportComment").value=a,document.getElementById("comments["+b+"].display").innerHTML=pvr.common_util.preserve_line_break(a)));e.find("#reportComment").val("");e.modal("hide");$("#reportCommentModal").data("modal",null);$(".noCommentSpan").hide()})},q=function(a){if("undefined"==typeof commentCounter||""==commentCounter)commentCounter=0;var b=$("<div>");b.attr("class","panelDiv");
b.attr("data-id",commentCounter);var d=$("<div>");d.attr("class","panel panel-default");var f=$("<div>"),e=$("<strong>");e.html($("#loggedInUser").html());var g=$("<span>");g.attr("class","text-muted");g.html("  "+$.i18n._("reportRequest.comment.date.label",moment(new Date).tz(userTimeZone).format(DATEPICKER_FORMAT_AM_PM)));var h=$("<div>");h.attr("class","deleteComment");h.attr("style","float: right; cursor: pointer");var k=$("<span>");k.attr("class","delete glyphicon glyphicon-trash reportRequest");
k.attr("data-name","COMMENT");h.append(k);k.click(function(){p(k)});var c=$("<div>");c.attr("style","float: right; cursor: pointer");var m=$("<span>");m.attr("class","glyphicon glyphicon-edit reportRequest");c.append(m);m.click(function(){var b=$(this).closest(".panelDiv").attr("data-id");l(a,null,b,!1)});f.append(e);f.append(g);f.append(h);f.append(c);e=$("<div>");g=$("<input>");g.attr("class","commentInput reportRequest");g.attr("type","hidden");g.attr("id","comments["+commentCounter+"].reportComment");
g.attr("name","comments["+commentCounter+"].reportComment");g.attr("value",a);h=$("<span>");h.attr("id","comments["+commentCounter+"].display");h.attr("style","word-wrap: break-word");h.html(pvr.common_util.preserve_line_break(a));c=$("<input>");c.attr("class","reportRequest commentDeleted");c.attr("type","hidden");c.attr("id","comments["+commentCounter+"].deleted");c.attr("name","comments["+commentCounter+"].deleted");c.attr("value",!1);e.append(c);c=$("<input>");c.attr("class","reportRequest");
c.attr("type","hidden");c.attr("id","comments["+commentCounter+"].id");c.attr("name","comments["+commentCounter+"].id");c.attr("value",null);e.append(c);c=$("<input>");c.attr("class","reportRequest");c.attr("type","hidden");c.attr("id","comments["+commentCounter+"].newObj");c.attr("name","comments["+commentCounter+"].newObj");c.attr("value",!0);e.append(c);c=$("<input>");c.attr("class","reportRequest commentDateCreated");c.attr("type","hidden");c.attr("id","comments["+commentCounter+"].dateCreated");
c.attr("name","comments["+commentCounter+"].dateCreated");c.attr("value",moment(new Date).tz(userTimeZone).format(DATEPICKER_FORMAT_AM_PM));e.append(c);e.append(g);e.append(h);d.append(f);d.append(e);b.append(d);$(".reportCommentDiv").append(b)};$(".deleteIcon").click(function(){p($(this))});$(".editComment").click(function(){var a=$(this).closest(".panelDiv").find(".reportComment").val(),b=$(this).closest(".panelDiv").find(".commentId").val(),d=$(this).closest(".panelDiv").attr("data-id");l(a,b,
d,!1)});var p=function(a){var b=$(a).parents(".panel");a=$(a).attr("data-name");var d;"ACTIONITEM"===a?d=".actionItemDeleted":"COMMENT"===a&&(d=".commentDeleted");a=b.parents(".associationsDiv");0===a.children().length?$(".noAssociations").show():0===a.children(":visible").length?$(".noAssociations").show():$(".noAssociations").hide();b.find(d).val(!0);b.closest(".panelDiv").hide()};$(".editActionItem").click("click",function(){var a=$(this).parent().attr("data-id"),b=$(this).closest(".panelDiv").attr("data-id");
actionItem.actionItemModal.edit_action_item(hasAccessOnActionItem,a,!1,REPOERT_REQUEST,b)});$("#createActionItem").click(function(){actionItem.actionItemModal.init_action_item_modal(!1,REPOERT_REQUEST)});$(".addTaskFromTemplate").click(function(){if($("#dueDate").val()){$("#noDueDate").removeClass("show");var a=$(".taskTemplate").val();$.ajax({url:findTaskUrl,data:"taskTemplateId="+a,error:function(a){console.log(a)},success:function(a){for(var d=0;d<a.length;d++)reportRequest.reportRequestActionItems.add_action_item_from_task(a[d])}})}else $("#noDueDate").html($.i18n._("dueDateNotNull")),
$("#noDueDate").addClass("show")});$("#dueDateDiv").on("changed.fu.datepicker dateClicked.fu.datepicker",function(){var a=$("#dueDate").val();$(".reportActionItemDiv .panelDiv .panel ").each(function(b,d){b=moment(a,DEFAULT_DATE_DISPLAY_FORMAT);d=$(this).find(".aiDateSign").val();var f=$(this).find(".aiDate").val();"+"==d?b.add(parseInt(f),"days"):"-"==d&&b.subtract(parseInt(f),"days");actionItemDueDate=b.format(DEFAULT_DATE_DISPLAY_FORMAT);$(".actionItemDueDateAssignedTo").html(actionItemDueDate)})});
$(".update_button").on("click",function(){var a="";if("CLOSED"==$("#status").val()){$statuses=$(".statusString");for(var b=0;b<$statuses.length;b++)if("Closed"!=$($statuses[b]).html()){a=$.i18n._("reportRequest.actionItem.warning.label");break}}showWarningOrSubmit(saveUrl,a)});$(".createReport_button").on("click",function(){var a="true"===$(this).attr("forAdhoc")?createAdhocReportUrl:createAggregateReportUrl;$("form#configurationForm").attr("action",a);$("form#configurationForm").submit()});$(document).on("click",
".deleteAttachment",function(){$("#attachmentsToDelete").val($("#attachmentsToDelete").val()+","+$(this).attr("data-id"));$(this).parent().css("text-decoration","line-through");$(this).find(".btn").prop("disabled",!0)});$("#reportRequestLinkModal").on("shown.bs.modal",function(a){$("#deleteDlgErrorDiv").hide();$("#RRLinkTo").select2("val","");$("#RRLinkDescription").val("")});$(document).on("click","#saveLinkButton",function(){var a=$("#linksToAdd").val(),a=a?JSON.parse(a):[],b={id:0,altId:a.length,
from:$("#RRLinkFrom").val(),to:$("#RRLinkTo").select2("val"),toname:$("#RRLinkTo").select2("data").text,linkType:$("#linkType").select2("val"),linkTypename:$("#linkType").select2("data").text,description:$("#RRLinkDescription").val()};""===b.to||""===b.linkType?$("#deleteDlgErrorDiv").show():(a.push(b),$("#linksToAdd").val(JSON.stringify(a)),$("#RRlinkList").append(n(b)),$("#reportRequestLinkModal").modal("hide"))});$(document).on("click",".deleteNewLink",function(){var a=$(this).attr("data-id"),
b=$("#linksToAdd").val(),b=b?JSON.parse(b):[],b=_(b).filter(function(b){return b.altId!==a});$("#linksToAdd").val(JSON.stringify(b));$(this).parent().remove()});$(document).on("click",".deleteLink",function(){$("#linksToDelete").val($("#linksToDelete").val()+","+$(this).attr("data-id"));$(this).parent().remove()});$("[name=file]").change(function(a,b,d){$("#file_name").val($.map($("[name=file]")[0].files,function(a){return a.name}).join(";"))});(function(){var a=$("#linksToDelete").val();a&&_.each(a.split(","),
function(a,d,f){$(".deleteLink[data-id='"+a+"']").parent().remove()})})();(function(){var a=$("#linksToAdd").val();a&&_.each(JSON.parse(a),function(a,d,f){$("#RRlinkList").append(n(a))})})();bindSelect2WithUrl($("#RRLinkTo"),reportRequestDropdownURL,null,!0)});