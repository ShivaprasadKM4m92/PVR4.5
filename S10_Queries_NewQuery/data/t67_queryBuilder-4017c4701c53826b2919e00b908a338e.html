//# sourceMappingURL=queryBuilder.js.map
var AJAXKeywordList,AJAXValueSampleList=[],AJAXValueExtraList,AJAXOperatorStringList,AJAXOperatorNumList,AJAXOperatorDateList,AJAXOperatorValuelessList,AJAXFinished=5,AJAXCount=0,RF_TYPE_TEXT="text",RF_TYPE_STRING="string",RF_TYPE_DATE="date",RF_TYPE_NUMBER="number",RF_TYPE_PART_DATE="partialDate",RF_TYPE_AUTOCOMPLETE="autocomplete",EDITOR_TYPE_TEXT=0,EDITOR_TYPE_DATE=1,EDITOR_TYPE_SELECT=2,EDITOR_TYPE_NONE=3,EDITOR_TYPE_AUTOCOMPLETE=4,EDITOR_TYPE_RPT_FIELD=5,LAST_X_DATE_OPERATORS=["LAST_X_DAYS",
"LAST_X_WEEKS","LAST_X_MONTHS","LAST_X_YEARS"],NEXT_X_DATE_OPERATORS=["NEXT_X_DAYS","NEXT_X_WEEKS","NEXT_X_MONTHS","NEXT_X_YEARS"],RELATIVE_DATE_OPERATORS="YESTERDAY LAST_WEEK LAST_MONTH LAST_YEAR TOMORROW NEXT_WEEK NEXT_MONTH NEXT_YEAR".split(" "),IS_EMPTY_OPERATORS=["IS_EMPTY","IS_NOT_EMPTY"],EQUALS_OPERATORS=["EQUALS","NOT_EQUAL"],REASSESS_LISTEDNESS_FIELD="dvListednessReassessQuery",REASSESS_LISTEDNESS_FIELD_J="dvListednessReassessQueryJ",RLDS_KEY="RLDS",hasBlanks=!1,keys=[],activeTab,$selectedField,
$selectedOperator,$selectedValue,$selectDate,$selectSelect,$selectSelectField,selectedGroup,builderAll,builderSubgroup,$queryJSON,dragSourceEl,draggingFromGroup,$selectedQuery,selectedSetGroup,setBuilderAll,setBuilderSubgroup,$setJSON,$queryBuilder,$queryBuilderTab,$queryBuilderLink,$setBuilder,$setBuilderTab,$setBuilderLink,$customSQL,$customSQLTab,$customSQLLink,Expressions,Sets,Expression,ExpressionList,SetList,backboneExpressions,expressionList,backboneSets,setList,copyAndPastesFields={};
$(document).ready(function(){function a(){$.ajax({type:"GET",url:extraValuesUrl,dataType:"json",data:{lang:userLocale},success:function(a){AJAXValueExtraList=a;AJAXCount==AJAXFinished?l():AJAXCount++}})}function b(){$.ajax({type:"GET",url:dateOperatorsUrl,dataType:"json",success:function(a){AJAXOperatorDateList=a;AJAXCount==AJAXFinished?l():AJAXCount++}})}function d(){$.ajax({type:"GET",url:numOperatorsUrl,dataType:"json",success:function(a){AJAXOperatorNumList=a;AJAXCount==AJAXFinished?l():AJAXCount++}})}
function c(){$.ajax({type:"GET",url:stringOperatorsUrl,dataType:"json",success:function(a){AJAXOperatorStringList=a;AJAXCount==AJAXFinished?l():AJAXCount++}})}function e(){$.ajax({type:"GET",url:valuelessOperatorsUrl,dataType:"json",success:function(a){AJAXOperatorValuelessList=a;AJAXCount==AJAXFinished?l():AJAXCount++}})}function h(){$.ajax({type:"GET",url:keywordsUrl,dataType:"json",success:function(a){AJAXKeywordList=a;AJAXCount==AJAXFinished?l():AJAXCount++}})}function f(a){$(getValueSelectFromExpression(a)).select2("val",
"");$(getValueSelectAutoFromExpression(a)).select2("val","");$(getReportFiledSelectFromExpression(a)).select2("val","");$(getValueTextFromExpression(a)).val("")}function g(a){var b=getFieldType($(getFieldFromExpression(a)).find(":selected")),d=getOperatorFromExpression(a);$(d).empty();switch(b){case RF_TYPE_DATE:$.each(AJAXOperatorDateList,function(a,b){$(d).append($("<option></option>").attr("value",this.value).text(this.display))});break;case RF_TYPE_NUMBER:$.each(AJAXOperatorNumList,function(a,
b){$(d).append($("<option></option>").attr("value",this.value).text(this.display))});break;case RF_TYPE_AUTOCOMPLETE:case RF_TYPE_STRING:$.each(AJAXOperatorStringList,function(a,b){$(d).append($("<option></option>").attr("value",this.value).text(this.display))});break;case RF_TYPE_PART_DATE:$.each(AJAXOperatorDateList,function(a,b){$(d).append($("<option></option>").attr("value",this.value).text(this.display))})}}function k(a,b){var d=$(getFieldFromExpression(a)).select2("val"),c=$(getOperatorFromExpression(a))[0].value,
e=a.parentElement,f=getFieldType($(getFieldFromExpression(a)).find(":selected"));_.contains(IS_EMPTY_OPERATORS,c)?(void 0!=e&&null!=e.expressionIndex&&backboneExpressions.at(e.expressionIndex).set("value",b),showHideValue(EDITOR_TYPE_NONE,a)):f!=RF_TYPE_DATE&&f!=RF_TYPE_PART_DATE||!_.contains(RELATIVE_DATE_OPERATORS,c)?f==RF_TYPE_DATE&&(_.contains(LAST_X_DATE_OPERATORS,c)||_.contains(NEXT_X_DATE_OPERATORS,c))?showHideValue(EDITOR_TYPE_TEXT,a):$(a).find(".rptFieldInput").is(":checked")?showHideValue(EDITOR_TYPE_RPT_FIELD,
a):$(a).find(".poiInput").is(":checked")?showHideValue(EDITOR_TYPE_TEXT,a):f==RF_TYPE_DATE?showHideValue(EDITOR_TYPE_DATE,a):f==RF_TYPE_STRING?_.has(copyAndPastesFields,d)?showHideValue(EDITOR_TYPE_TEXT,a):_.contains(EQUALS_OPERATORS,c)&&AJAXValueSampleList[d]&&0<AJAXValueSampleList[d].length?showHideValue(EDITOR_TYPE_SELECT,a):showHideValue(EDITOR_TYPE_TEXT,a):f==RF_TYPE_AUTOCOMPLETE?_.has(copyAndPastesFields,d)?showHideValue(EDITOR_TYPE_TEXT,a):_.contains(EQUALS_OPERATORS,c)?showHideValue(EDITOR_TYPE_AUTOCOMPLETE,
a):showHideValue(EDITOR_TYPE_TEXT,a):showHideValue(EDITOR_TYPE_TEXT,a):(void 0!=e&&null!=e.expressionIndex&&backboneExpressions.at(e.expressionIndex).set("value",b),showHideValue(EDITOR_TYPE_NONE,a))}function m(a){var b=$(getFieldFromExpression(a)).select2("val"),d=getFieldType($(getFieldFromExpression(a)).find(":selected")),c=getValueSelectFromExpression(a);$(c).empty();$(a).find(".poiInput").is(":checked")?showHideValue(EDITOR_TYPE_TEXT,a):$(a).find(".rptFieldInput").is(":checked")?showHideValue(EDITOR_TYPE_RPT_FIELD,
a):_.has(copyAndPastesFields,b)?showHideValue(EDITOR_TYPE_TEXT,a):d!=RF_TYPE_DATE?d==RF_TYPE_AUTOCOMPLETE?showHideValue(EDITOR_TYPE_AUTOCOMPLETE,a):p(b,function(b){b&&0!==b.length?($(c).append($("<option></option>")),$.each(b,function(){$(c).append($("<option></option>").attr("value",this).text(this))}),showHideValue(EDITOR_TYPE_SELECT,a)):showHideValue(EDITOR_TYPE_TEXT,a)}):showHideValue(EDITOR_TYPE_DATE,a)}function p(a,b){$.ajax({type:"GET",url:possibleValuesUrl,async:!1,data:{lang:userLocale,field:a},
dataType:"json",success:function(d){AJAXValueSampleList[a]=d;b(d)},error:function(a){console.log(a);alert("errr")}})}function n(a){var b=getExtraValueRLDSSelectFromContainer(a);b&&(AJAXValueExtraList[REASSESS_LISTEDNESS_FIELD]&&0<AJAXValueExtraList[REASSESS_LISTEDNESS_FIELD].length&&$.each(AJAXValueExtraList[REASSESS_LISTEDNESS_FIELD],function(){$(b).append($("<option></option>").attr("value",this).text(this))}),AJAXValueExtraList[REASSESS_LISTEDNESS_FIELD_J]&&0<AJAXValueExtraList[REASSESS_LISTEDNESS_FIELD_J].length&&
$.each(AJAXValueExtraList[REASSESS_LISTEDNESS_FIELD_J],function(){$(b).append($("<option></option>").attr("value",this).text(this))}));(a=$(a).closest(".expression")[0])&&(a=backboneExpressions.at(a.expressionIndex))&&(a=a.get("RLDS"))&&$(b).select2("val",a.split(";"))}function l(){"QUERY_BUILDER"===queryType&&(n(document.getElementById("toAddExtraValues")),$.each($($(".builderAll")[0]).find(".expression"),function(){var a=$(this).find(".toAddContainer")[0];g(a);m(a);$(getOperatorFromExpression(a)).val(backboneExpressions.at($(this)[0].expressionIndex).get("op"));
k(a);n(a);var b=getCorrectSelectValueFromContainer(a);if(b===getValueTextFromExpression(a))$(getValueTextFromExpression(a)).val(backboneExpressions.at($(this)[0].expressionIndex).get("value"));else if(b===getValueSelectFromExpression(a))b=backboneExpressions.at($(this)[0].expressionIndex).get("value"),(b=b.split(";"))&&(b[0].trim()||(b=null)),$(getValueSelectFromExpression(a)).select2("val",b);else if(b===getValueSelectAutoFromExpression(a)){b=backboneExpressions.at($(this)[0].expressionIndex).get("value");
(b=b.split(";"))&&(b[0].trim()||(b=null));var d=[];_.each(b,function(a){d.push({id:a,text:a})});$(getValueSelectAutoFromExpression(a)).select2("data",d)}else b===getReportFiledSelectFromExpression(a)?$(getReportFiledSelectFromExpression(a)).select2("val",backboneExpressions.at($(this)[0].expressionIndex).get("value")):$(getValueDateInputFromExpression(a)).val(backboneExpressions.at($(this)[0].expressionIndex).get("value"))}));$.each($(".loading"),function(){$(this).hide()});$.each($(".doneLoading"),
function(){$(this).show()});editable||($("#toAddContainer").parent().hide(),$("#toAddContainerSet").parent().hide());AJAXCount=0;showHideReassessListedness(builderAll)}$selectedField=$("#selectDataSourceField");$selectedOperator=$("#selectOperator");$selectedValue=$("#selectValue");$selectDate=$("#selectDate");$selectSelect=$("#selectSelect");$selectSelectField=$("#selectRptField");builderAll=document.getElementById("builderAll");$queryJSON=$("#queryJSON");$selectedQuery=$("#selectQuery");setBuilderAll=
document.getElementById("setBuilderAll");$setJSON=$("#setJSON");$queryBuilder=$("#queryBuilder");$queryBuilderTab=$("#queryBuilderTab");$queryBuilderLink=$("#queryBuilderLink");$setBuilder=$("#setBuilder");$setBuilderTab=$("#setBuilderTab");$setBuilderLink=$("#setBuilderLink");$customSQL=$("#customSQL");$customSQLTab=$("#customSQLTab");$customSQLLink=$("#customSQLLink");$("#reassessListedness").select2();$("#sourceProfile").select2();$queryBuilder.on("change","#sourceProfile",function(){loadReportFieldOptions(queryReportFieldsOptsBySource,
!1,$(this).val(),[$selectedField,$selectSelectField],function(){showLoader()},function(){hideLoader()},function(){getSelect2TreeView($selectSelectField);getSelect2TreeView($selectedField)})});Expressions=Backbone.Collection.extend({});Sets=Backbone.Collection.extend({});Expression=Backbone.Model.extend({});loadReportFieldOptions(queryDefaultReportFieldsOpts,!0,"",[$("#selectDataSourceField"),$selectSelectField],function(){showLoader();$("div.tab-content").hide()},function(){hideLoader();$("div.tab-content").show()},
function(){ExpressionList=Backbone.View.extend({initialize:function(){var a=$queryJSON.val();null==a||""==a?(selectedGroup=createGroup(),builderAll.appendChild(selectedGroup)):(buildQueryFromJSON(a),selectedGroup=$(builderAll).find(".group")[0]);addSubgroup(builderAll);builderSubgroup=getSubgroup(builderAll);$(selectedGroup).addClass("selectedGroup");$("#queryBuilder").on("query.builder.updateAJAXValues",function(a){m(a.target)});$queryJSON.val(printAll())}});SetList=Backbone.View.extend({initialize:function(){var a=
$("#setJSON").val();null==a||""==a?(selectedSetGroup=createGroup(),setBuilderAll.appendChild(selectedSetGroup)):(buildSetFromJSON(a),selectedSetGroup=$(setBuilderAll).find(".group")[0]);addSubgroup(setBuilderAll);setBuilderSubgroup=getSubgroup(setBuilderAll);$(selectedSetGroup).addClass("selectedGroup");$setJSON.val(printSet())}});if(editable)switch(queryType){case "SET_BUILDER":setActiveTabSet();break;case "CUSTOM_SQL":setActiveTabCustom()}else $("#customSQLQuery").attr("disabled",!0),$("#toAddContainer :input").attr("disabled",
"disabled"),$("#toAddContainerSet :input").attr("disabled","disabled"),$("#reassessListedness").attr("disabled",!0),$("#reassessListednessDSSelect").prop("disabled",!0),$("#reassessForProduct").attr("disabled",!0);if(disableInactiveTabs)switch(queryType){case "QUERY_BUILDER":disableTabLink($setBuilderLink);disableTabLink($customSQLLink);break;case "SET_BUILDER":setActiveTabSet();disableTabLink($queryBuilderLink);disableTabLink($customSQLLink);break;case "CUSTOM_SQL":setActiveTabCustom(),disableTabLink($queryBuilderLink),
disableTabLink($setBuilderLink)}activeTab=queryType;$("#queryType").val(queryType);$('a[data-toggle="tab"]').on("click",function(a){activeTab=$(a.target).attr("aria-controls");$("#queryType").val(activeTab)});b();d();c();e();h();a();$("#showDate").hide();$("#showSelect").hide();$("#showSelectAuto").hide();$("#showSelectRpField").hide();$("#errorMessageOperator").hide();backboneExpressions=new Expressions;backboneSets=new Expressions;expressionList=new ExpressionList;setList=new SetList;getSelect2TreeView($("#selectDataSourceField"));
getSelect2TreeView($("#selectRptField"));$selectedField.on("change",function(){var a=$(this).find("option:selected").attr("data-description");a?$("#selectPopover").attr("data-content",a):$("#selectPopover").attr("data-content",$.i18n._("app.query.field.no.description"))});$("#selectSelect").select2();$("#selectSelectAuto").select2({minimumInputLength:2,multiple:!0,separator:";",ajax:{quietMillis:300,dataType:"json",url:selectAutoUrl,data:function(a,b){var d=$(this).closest(".toAddContainer")[0];return{field:$(getFieldFromExpression(d)).select2("val"),
term:a,max:10*b,lang:userLocale}},results:function(a,b){return{results:a,more:10*b<=a.length}}}});$("#reassessListednessDSSelect").select2();$("#selectDate").datepicker({allowPastDates:!0,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});$("#queryLevel").select2();$.each($(".doneLoading"),function(){$(this).hide()});bindQuerySelect2($selectedQuery);$("#mainContent").on("change",".expressionField",function(){function a(){return $("#selectDataSourceField option:selected").attr("data-dictionary")}
copyAndPastesFields={};var b=$(this).closest(".toAddContainer")[0],d=$(b).closest(".expression")[0],c=$(this)[0].value;g(b);m(b);if(c===REASSESS_LISTEDNESS_FIELD||c===REASSESS_LISTEDNESS_FIELD_J)addShowRLDS(b,null,c),showHideReassessListedness(builderAll,!0);else{var e=getExtraValueRLDSSelectFromContainer(b);0<e.length&&$(e[0].parentElement).remove();showHideReassessListedness(builderAll)}if("undefined"!=typeof a())switch(a().toLowerCase()){case EVENT_DICTIONARY:showEventDicIcon(!0);showProductDicIcon(!1);
showStudyDicIcon(!1);break;case PRODUCT_DICTIONARY:showEventDicIcon(!1);showProductDicIcon(!0);showStudyDicIcon(!1);break;case STUDY_DICTIONARY:showEventDicIcon(!1);showProductDicIcon(!1);showStudyDicIcon(!0);break;default:showEventDicIcon(!1),showProductDicIcon(!1),showStudyDicIcon(!1)}d&&void 0!=d&&null!=d.expressionIndex&&(backboneExpressions.at(d.expressionIndex).set("field",c),backboneExpressions.at(d.expressionIndex).set("op",$(getOperatorFromExpression(b)).val()),backboneExpressions.at(d.expressionIndex).set("value",
""),c!==REASSESS_LISTEDNESS_FIELD&&c!==REASSESS_LISTEDNESS_FIELD_J||backboneExpressions.at(d.expressionIndex).set(RLDS_KEY,""));f(b);""!=c&&$(this.parentElement).removeClass("has-error");$queryJSON.val(printAll())});$("#mainContent").on("change",".expressionOp",function(){var a=$(this).closest(".toAddContainer"),b=a.closest(".expression")[0],d=$(this)[0].value;k(a,d);if(b&&void 0!=b&&null!=b.expressionIndex){backboneExpressions.at(b.expressionIndex).set("op",d);var c=!1;$.each(AJAXOperatorValuelessList,
function(a,b){if(null!=b&&b.value==d)return c=!0,!1});c?backboneExpressions.at(b.expressionIndex).set("value",d):backboneExpressions.at(b.expressionIndex).set("value","")}f(a);$queryJSON.val(printAll())});$("#mainContent").on("change",".expressionValueText",function(){var a=$(this).closest(".toAddContainer"),b=a.closest(".expression")[0];b&&void 0!=b&&null!=b.expressionIndex&&backboneExpressions.at(b.expressionIndex).set("value",$(getValueTextFromExpression(a))[0].value);""!=$(this)[0].value&&$(this.parentElement).removeClass("has-error");
$queryJSON.val(printAll())});$("#mainContent").on("change",".expressionValueSelect",function(){var a=$(this).closest(".toAddContainer"),b=$(a).closest(".expression")[0],a=$(getValueSelectFromExpression(a)).select2("val");$.isArray(a)&&(a=$.grep(a,function(a){if(""!=a)return a}),0==a.length&&(a=""));if(b&&void 0!=b&&null!=b.expressionIndex){if($.isArray(a)){for(var d="",c=0;c<a.length;c++)d=0!=c?d+(";"+a[c]):d+a[c];a=d}backboneExpressions.at(b.expressionIndex).set("value",a)}$queryJSON.val(printAll())});
$("#mainContent").on("change",".expressionValueRptField",function(){var a=$(this).closest(".toAddContainer"),b=$(a).closest(".expression")[0],a=$(getReportFiledSelectFromExpression(a)).select2("val");$.isArray(a)&&(a=$.grep(a,function(a){if(""!=a)return a}),0==a.length&&(a=""));if(b&&void 0!=b&&null!=b.expressionIndex){if($.isArray(a)){for(var d="",c=0;c<a.length;c++)d=0!=c?d+(";"+a[c]):d+a[c];a=d}backboneExpressions.at(b.expressionIndex).set("value",a)}$queryJSON.val(printAll())});$("#mainContent").on("change",
".expressionValueSelectAuto",function(){var a=$(this).closest(".toAddContainer"),b=$(a).closest(".expression")[0],a=$(getValueSelectAutoFromExpression(a)).select2("val");$.isArray(a)&&(a=$.grep(a,function(a){if(""!=a)return a}),0==a.length&&(a=""));if(b&&void 0!=b&&null!=b.expressionIndex){if($.isArray(a)){for(var d="",c=0;c<a.length;c++)d=0!=c?d+(";"+a[c]):d+a[c];a=d}backboneExpressions.at(b.expressionIndex).set("value",a)}$queryJSON.val(printAll())});$("#mainContent").on("change",".reassessListednessDS",
function(){var a=$(this).closest(".toAddContainer"),b=$(a).closest(".expression")[0],a=$(getExtraValueRLDSSelectFromContainer(a)).select2("val");$.isArray(a)&&(a=$.grep(a,function(a){if(""!=a)return a}),0==a.length&&(a=""));if(b&&void 0!=b&&null!=b.expressionIndex){if($.isArray(a)){for(var d="",c=0;c<a.length;c++)d=0!=c?d+(";"+a[c]):d+a[c];a=d}backboneExpressions.at(b.expressionIndex).set(RLDS_KEY,a)}$queryJSON.val(printAll())});$("#mainContent").on("change",".expressionQuery",function(){var a=this.parentElement.parentElement.parentElement,
b=$(this)[0].value;void 0!=a&&null!=a.expressionIndex&&backboneSets.at(a.expressionIndex).set("query",b);""!=b&&$(this.parentElement).removeClass("has-error");$queryJSON.val(printAll())});$("#mainContent").on("change",".keywordExpression",function(){var a=this.parentElement,b=a.parentElement,d=!1;if(2<getExpressionOrGroupCountFromGroup(b)){var c=getFirstChildWithClassnameIndexFromElement("expression",b),e=getKeywordIndexFromElement(b.children[c]);this===b.children[c].children[e]&&(c=getSecondChildWithClassnameIndexFromElement("expression",
b),-1==c&&(c=getFirstChildWithClassnameIndexFromElement("group",b)),e=getKeywordIndexFromElement(b.children[c]));$(this).val()!=$(b.children[c].children[e]).val()&&(d=!0);d&&(c=getChildIndexFromParent(a,b),d=encapsulateFromIndexToIndexInNewGroup(b,c+1,getLastExpressionOrGroupIndexFromGroup(b)),b.insertBefore(d,b.children[c].nextSibling),c=encapsulateFromIndexToIndexInNewGroup(b,0,c),b.insertBefore(c,b.firstChild),a=a.children[getKeywordIndexFromElement(a)],addKeyword(c,a.value,"keywordGroup"),cleanUpKeywords(c),
cleanUpKeywords(d),cleanUpKeywordGroups(b))}printToJSON()});$("#mainContent").on("change",".keywordGroup",function(){var a=this.parentElement,b=a.parentElement,d=!1;if(2<getExpressionOrGroupCountFromGroup(b)){var c=getFirstChildWithClassnameIndexFromElement("group",b),e=getKeywordIndexFromElement(b.children[c]);this===b.children[c].children[e]&&(c=getSecondChildWithClassnameIndexFromElement("group",b),e=getKeywordIndexFromElement(b.children[c]));$(this).val()!=$(b.children[c].children[e]).val()&&
(d=!0);d&&(c=getChildIndexFromParent(a,b),d=encapsulateFromIndexToIndexInNewGroup(b,c+1,getLastExpressionOrGroupIndexFromGroup(b)),b.insertBefore(d,b.children[c].nextSibling),c=encapsulateFromIndexToIndexInNewGroup(b,0,c),b.insertBefore(c,b.firstChild),a=a.children[getKeywordIndexFromElement(a)],addKeyword(c,a.value,"keywordGroup"),cleanUpKeywordGroups(c),cleanUpKeywordGroups(d),cleanUpKeywordGroups(b))}printToJSON()});$("#mainContent").on("click",".removeExpression",function(){var a=this.parentElement.parentElement,
b=this.parentElement.expressionIndex;backboneExpressions.remove(backboneExpressions.at(b));backboneSets.remove(backboneSets.at(b));checkIndexes(b);$(this.parentElement).remove();0<a.children.length&&cleanUpKeywords(a);showHideReassessListedness(builderAll);printToJSON()});$("#mainContent").on("click",".removeGroup",function(){for(var a=this.parentElement,b=a.parentElement,c=$(a).find(".expression"),d,e=0;e<c.length;e++)d=c[e].expressionIndex,backboneExpressions.remove(backboneExpressions.at(d)),checkIndexes(d);
$(this.parentElement).remove();0<a.children.length&&(cleanUpKeywordGroups(a),cleanUpKeywords(a));cleanUpKeywordGroups(b);cleanUpKeywords(b);showHideReassessListedness(builderAll);printToJSON()});$("body").on("click",".rptFieldInput, .poiInput",function(){var a=$(this).closest(".toAddContainer");$(this).prop("checked")&&($(this).hasClass("rptFieldInput")?a.find(".poiInput").prop("checked",!1):a.find(".rptFieldInput").prop("checked",!1));m(a)});$("#addExpression").click(function(){$("#errorMessageOperator").hide();
var a=!0;""===$selectedField.val()&&($selectedField.parent().addClass("has-error"),a=!1);if(a){var a=document.getElementById("toAddContainer"),b=$(getFieldFromExpression(a)).select2("val"),c=getFieldType($(getFieldFromExpression(a)).find(":selected")),d=$(getOperatorFromExpression(a))[0].value,e,f=[],h=!1;if($($(a).find(".expressionValueText")[0]).is(":visible"))if(c==RF_TYPE_DATE){if(e=$($(a).find(".expressionValueText")[0])[0].value,!_.isEmpty(e)&&$.isNumeric(e)&&(c=$(a).find(".poiInput").is(":checked"),
0>=e||!c&&isNaN(e)))return $("#errorMessageOperator").show(),!1}else e=$($(a).find(".expressionValueText")[0])[0].value;else $($(a).find(".expressionValueSelect")[0]).is(":visible")?(e=$(getValueSelectFromExpression(a)).select2("val"),$.isArray(e)&&(e=$.grep(e,function(a){return""!=a}))):$($(a).find(".expressionValueRptField")[0]).is(":visible")?(e=$(getReportFiledSelectFromExpression(a)).select2("val"),$.isArray(e)&&(e=$.grep(e,function(a){return""!=a}))):$($(a).find(".expressionValueSelectAuto")[0]).is(":visible")?
(e=$(getValueSelectAutoFromExpression(a)).select2("val"),$.isArray(e)&&(e=$.grep(e,function(a){return""!=a}),_.each(e,function(a){f.push({id:a,text:a})}))):$($(a).find(".expressionValueDateInput")[0]).is(":visible")?(e=$($(a).find(".expressionValueDateInput")[0])[0].value,h=!0):e=$($(a).find(".expressionOp")[0])[0].value;if(-1<d.search("LAST_X")&&!checkNumberFields(e,a))return!1;$("#selectDataSourceField").select2("destroy");$("#selectSelect").select2("destroy");$("#selectRptField").select2("destroy");
$(getExtraValueRLDSSelectFromContainer(a)).select2("destroy");$("#selectSelectAuto").select2("destroy");c=a.cloneNode(!0);$(c).removeAttr("id");$(getValueDateFromExpression(c)).datepicker({allowPastDates:!0,momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});h&&$(getValueDateFromExpression(c)).datepicker("setDate",e);null!=e&&""!=e||$(getValueDateInputFromExpression(c)).val("");addOnchangeMethodsToDatepickerElement(getValueDateFromExpression(c));var h={},g=getExtraValueRLDSSelectFromContainer(a);
g&&(g=$(g).val(),$.isArray(g)&&(g=$.grep(g,function(a){return""!=a})),h[RLDS_KEY]=g);0<$(builderAll).find(".selectedGroup").length?g=selectedGroup:(g=$(builderAll).find(".group"),0==g.length?(g=createGroup(),builderAll.insertBefore(g,builderAll.children[0])):g=g[0],selectedGroup=g,$(selectedGroup).addClass("selectedGroup"));var k=getLastChildWithClassnameIndexFromElement("expression",g);-1<k?g.insertBefore(createExpressionFromInput(c,b,d,e,h),g.children[k].nextSibling):0<g.children.length&&g.insertBefore(createExpressionFromInput(c,
b,d,e,h),g.children[0]);$(getFieldFromExpression(c)).select2();$(getValueSelectFromExpression(c)).select2();$(getReportFiledSelectFromExpression(c)).select2();$(getExtraValueRLDSSelectFromContainer(c)).select2();getSelect2TreeView($("#selectDataSourceField"));$("#selectSelect").select2();getSelect2TreeView($("#selectRptField"));$(getExtraValueRLDSSelectFromContainer(a)).select2();$(getValueSelectAutoFromExpression(c)).select2({minimumInputLength:2,multiple:!0,separator:";",ajax:{quietMillis:300,dataType:"json",
url:selectAutoUrl,data:function(a,b){var c=$(this).closest(".toAddContainer")[0];return{field:$(getFieldFromExpression(c)).select2("val"),term:a,max:10*b,lang:userLocale}},results:function(a,b){return{results:a,more:10*b<=a.length}}}});$(getValueSelectAutoFromExpression(c)).select2("data",f);$("#selectSelectAuto").select2({minimumInputLength:2,separator:";",multiple:!0,ajax:{quietMillis:300,dataType:"json",url:selectAutoUrl,data:function(a,b){var c=$(this).closest(".toAddContainer")[0];return{field:$(getFieldFromExpression(c)).select2("val"),
term:a,max:10*b,lang:userLocale}},results:function(a,b){return{results:a,more:10*b<=a.length}}}});$("#selectSelectAuto").select2("val","");a=$("#selectSelect").select2("val");for(b=a.length;b--;)""===a[b]&&a.splice(b,1);$("#selectSelect").select2("val",a);cleanUpKeywords(g);printToJSON();showHideReassessListedness(builderAll);$(c).find(".fa-search").hide();$(c).find('[data-toggle="popover"]').removeAttr("id");$(c).find("#addExpression").remove();$('[data-toggle="popover"]').popover()}});$("#addQuery").click(function(){var a=
!0;""==$selectedQuery.val()&&($selectedQuery.parent().addClass("has-error"),a=!1);if(a){var b=document.getElementById("toAddContainerSet"),a=$selectedQuery.select2("val");$selectedQuery.select2("destroy");b=b.cloneNode(!0);$(b).removeAttr("id");var c;0<$(setBuilderAll).find(".selectedGroup").length?c=selectedSetGroup:(c=$(setBuilderAll).find(".group"),0==c.length?(c=createGroup(),setBuilderAll.insertBefore(c,setBuilderAll.children[0])):c=c[0],selectedSetGroup=c,$(selectedSetGroup).addClass("selectedGroup"));
var d=getLastChildWithClassnameIndexFromElement("expression",c);-1<d?c.insertBefore(createSetExpressionFromInput(b,a),c.children[d].nextSibling):0<c.children.length&&c.insertBefore(createSetExpressionFromInput(b,a),c.children[0]);bindQuerySelect2($(getQueryFromExpression(b)));bindQuerySelect2($selectedQuery);cleanUpKeywords(c);$("#setJSON").val(printSet())}})})});
function printAll(){hasBlanks=!1;keys=[];var a=$(document).find(".builderAll")[0],b='{"all":{"containerGroups":['+printRecurJSON(a);if(hasBlanks){b+=',"blankParameters":[';for(a=0;a<keys.length;a++)0<a&&(b+=","),b+="{"+keys[a]+"}";b+="]"}$.isEmptyObject(copyAndPastesFields)||(b+=', "copyAndPasteFields":[',_.each(copyAndPastesFields,function(a){a.content="";a=JSON.stringify(a);b+=a+","}),b=b.slice(0,-1),b+="]");b+="}";$("#hasBlanksQuery").val(""+hasBlanks);return b}
function printRecurJSON(a){for(var b=" ",d,c=getLastExpressionOrGroupIndexFromGroup(a),e=-1,h=-1,f=!1,g=0;g<a.children.length;g++){if(a.children[g].classList.contains("expression")){var f=backboneExpressions.at(a.children[g].expressionIndex),k=f.get("op");_.contains(IS_EMPTY_OPERATORS,k)||_.contains(RELATIVE_DATE_OPERATORS,k)?f.set("value",k):f.set("value",f.get("value"));b+='{"index":"'+a.children[g].expressionIndex+'","field":"'+f.get("field")+'","op":"'+k+'","value":"'+f.get("value")+'"';f.has(RLDS_KEY)&&
(b+=',"RLDS":"'+f.get(RLDS_KEY)+'"');if(null==f.get("value")||""==$.trim(f.get("value"))||f.get("value").match(/^\&/))hasBlanks=!0,keys.push('"key":'+(keys.length+1)+',"field":"'+f.get("field")+'","op":"'+k+'","value":"'+f.get("value")+'"'),b+=',"key":"'+keys.length+'"';b+="}";-1==e&&(e=g);f=!0}else a.children[g].classList.contains("group")&&(b+='{"expressions":['+printRecurJSON(a.children[g]),-1==h&&(h=g),f=!0);f&&g<c&&(b+=", ",f=!1)}if(-1!=e){if(c=getKeywordIndexFromElement(a.children[e]),-1!=c&&
(d=a.children[e].children[c].value),d)return b+'],"keyword":"'+d+'"}'}else if(-1==e&&-1!=h&&(c=getKeywordIndexFromElement(a.children[h]),-1!=c&&(d=a.children[h].children[c].value),d))return b+'],"keyword":"'+d+'"}';return b+" ] } "}
function buildQueryFromJSON(a){a=JSON.parse(a);var b=a.all,d=b.containerGroups;buildCopyAndPasteFields(a,d);var c=b.keyword;d.forEach(function(a){var b=createGroup(),d=getLastExpressionOrGroupIndexFromGroup(builderAll);-1!=d?builderAll.insertBefore(b,builderAll.children[d].nextSibling):builderAll.insertBefore(b,builderAll.firstChild);a.expressions.forEach(function(c){parseGroup(b,c,a.keyword)});c&&addKeyword(b,c,"keywordGroup");cleanUpKeywords(b);cleanUpKeywordGroups(b)});cleanUpKeywordGroups(builderAll);
$('[data-toggle="popover"]').popover()}
function parseGroup(a,b,d){if(b.expressions){var c=createGroup(),e=getLastExpressionOrGroupIndexFromGroup(a);-1!=e?a.insertBefore(c,a.children[e].nextSibling):a.insertBefore(c,a.firstChild);b.expressions.forEach(function(a){parseGroup(c,a,b.keyword)});d&&addKeyword(c,d,"keywordGroup");cleanUpKeywords(c);cleanUpKeywordGroups(c)}else{e=document.createElement("div");e.className="expression";var h=document.getElementById("toAddContainer").cloneNode(!0);$(h).removeAttr("id");$(getValueDateFromExpression(h)).datepicker({allowPastDates:!0,
momentConfig:{culture:userLocale,format:DEFAULT_DATE_DISPLAY_FORMAT}});addOnchangeMethodsToDatepickerElement(getValueDateFromExpression(h));e.appendChild(h);var f;f=_.contains(IS_EMPTY_OPERATORS,b.op)?b.op:b.value;isSpecialKeyValue(f)&&$(getPOICheckBoxFromExpression(h)).attr("checked","checked");isReportFieldKeyValue(f)&&$(getRptInputCheckBoxFromExpression(h)).attr("checked","checked");var g=new Expression({field:b.field,op:b.op,value:f});RLDS_KEY in b&&(addShowRLDS(h,b[RLDS_KEY],null),$(getExtraValueRLDSSelectFromContainer(h)).select2("val",
b[RLDS_KEY]),g.set(RLDS_KEY,b[RLDS_KEY]));backboneExpressions.add(g);getValueTextFromExpression(e).value=f;var k=$(getFieldFromExpression(h));k.val(b.field);k.select2();f=k.parent().find('[data-toggle="popover"]');(k=k.find("option:selected").attr("data-description"))?f.attr("data-content",k):f.attr("data-content",$.i18n._("app.query.field.no.description"));f.removeAttr("id");$(getValueSelectFromExpression(h)).select2();$(getReportFiledSelectFromExpression(h)).select2();h=getValueSelectAutoFromExpression(h);
$(h).select2({minimumInputLength:2,separator:";",multiple:!0,ajax:{quietMillis:300,dataType:"json",url:selectAutoUrl,data:function(a,b){var c=$(this).closest(".toAddContainer")[0];return{field:$(getFieldFromExpression(c)).select2("val"),term:a,max:10*b,lang:userLocale}},results:function(a,b){return{results:a,more:10*b<=a.length}}}});d&&addKeyword(e,d,"keywordExpression");editable&&addButtonRemove(e,"removeExpression");e.expressionIndex=backboneExpressions.indexOf(g);editable&&(addDragListeners(e),
e.draggable=!0);d=getLastChildWithClassnameIndexFromElement("expression",a);-1!=d?a.insertBefore(e,a.children[d].nextSibling):a.insertBefore(e,a.firstChild)}}
function buildCopyAndPasteFields(a,b){"undefined"!==typeof a.copyAndPasteFields&&_.each(a.copyAndPasteFields,function(a){copyAndPastesFields[a.field]={field:a.field,content:null,delimiter:a.delimiter}});_.isEmpty(b)||_.each(b,function(a){_.each(a.expressions,function(a){_.find(copyAndPastesFields,function(b){return b.field===a.field})&&(copyAndPastesFields[a.field].content=a.value)})})}
function printToJSON(){"QUERY_BUILDER"===activeTab?$queryJSON.val(printAll()):"SET_BUILDER"===activeTab&&$setJSON.val(printSet())}function printSet(){hasBlanks=!1;keys=[];return'{ "all": { "containerGroups": [ '+printRecurJSONSet(setBuilderAll)+"}"}
function printRecurJSONSet(a){for(var b=" ",d,c=getLastExpressionOrGroupIndexFromGroup(a),e=-1,h=-1,f=!1,g=0;g<a.children.length;g++)a.children[g].classList.contains("expression")?(f=backboneSets.at(a.children[g].expressionIndex),b+=' { "index": "'+a.children[g].expressionIndex+'", "query": "'+f.get("query")+'"',b+=" } ",-1==e&&(e=g),f=!0):a.children[g].classList.contains("group")&&(b+=' { "expressions": ['+printRecurJSONSet(a.children[g])+" ",-1==h&&(h=g),f=!0),f&&g<c&&(b+=", ",f=!1);if(-1!=e){if(c=
getKeywordIndexFromElement(a.children[e]),-1!=c&&(d=a.children[e].children[c].value),d)return b+'] , "keyword": "'+d+'" } '}else if(-1==e&&-1!=h&&(c=getKeywordIndexFromElement(a.children[h]),-1!=c&&(d=a.children[h].children[c].value),d))return b+'] , "keyword": "'+d+'" } ';return b+" ] } "}
function buildSetFromJSON(a){a=JSON.parse(a).all;var b=a.keyword;a.containerGroups.forEach(function(a){var c=createGroup(),e=getLastExpressionOrGroupIndexFromGroup(setBuilderAll);-1!=e?setBuilderAll.insertBefore(c,setBuilderAll.children[e].nextSibling):setBuilderAll.insertBefore(c,setBuilderAll.firstChild);a.expressions.forEach(function(b){parseSetGroup(c,b,a.keyword)});b&&addKeyword(c,b,"keywordGroup");cleanUpKeywords(c);cleanUpKeywordGroups(c)});cleanUpKeywordGroups(setBuilderAll)}
function parseSetGroup(a,b,d){if(b.expressions){var c=createGroup(),e=getLastExpressionOrGroupIndexFromGroup(a);-1!=e?a.insertBefore(c,a.children[e].nextSibling):a.insertBefore(c,a.firstChild);b.expressions.forEach(function(a){parseSetGroup(c,a,b.keyword)});d&&addKeyword(c,d,"keywordGroup");cleanUpKeywords(c);cleanUpKeywordGroups(c)}else{e=document.createElement("div");e.className="expression";var h=document.getElementById("toAddContainerSet").cloneNode(!0);$(h).removeAttr("id");e.appendChild(h);
var f=new Expression({query:b.query});backboneSets.add(f);h=$(getQueryFromExpression(h));h.val(b.query);bindQuerySelect2(h);d&&addKeyword(e,d,"keywordExpression");editable&&addButtonRemove(e,"removeExpression");e.expressionIndex=backboneSets.indexOf(f);editable&&(addDragListeners(e),e.draggable=!0);d=getLastChildWithClassnameIndexFromElement("expression",a);-1!=d?a.insertBefore(e,a.children[d].nextSibling):a.insertBefore(e,a.firstChild)}}
function handleDragStart(a){this.style.opacity="0.4";dragSourceEl=this;draggingFromGroup=this.parentElement;"QUERY_BUILDER"===activeTab?$(builderSubgroup).show():"SET_BUILDER"===activeTab&&$(setBuilderSubgroup).show()}function handleDragOver(a){a.preventDefault&&a.preventDefault();return!1}
function handleDragEnter(a){this.classList.add("over");null==draggingFromGroup&&(draggingFromGroup=this);if(!draggingFromGroup.contains(this)){a=$(draggingFromGroup).find(".subgroup");for(var b=0;b<a.length;b++)$(a[b]).hide()}$(this).hasClass("group")&&($(getSubgroup(this)).show(),draggingFromGroup=this)}function handleDragLeave(a){this.classList.remove("over")}
function handleDrop(a){a.stopPropagation&&a.stopPropagation();if(dragSourceEl!=this){var b;"QUERY_BUILDER"===activeTab?(b=$(this).find(".toAddContainer")[0],this.insertBefore($(dragSourceEl).find(".toAddContainer")[0],this.children[0])):"SET_BUILDER"===activeTab&&(b=$(this).find(".toAddContainerSet")[0],this.insertBefore($(dragSourceEl).find(".toAddContainerSet")[0],this.children[0]));dragSourceEl.insertBefore(b,dragSourceEl.children[0]);a=dragSourceEl.expressionIndex;dragSourceEl.expressionIndex=
this.expressionIndex;this.expressionIndex=a}$(getSubgroup(this.parentElement)).hide();return!1}
function handleDragEnd(a){this.style.opacity="1";[].forEach.call($(".expression"),function(a){a.classList.remove("over")});[].forEach.call($(".group"),function(a){a.classList.remove("over")});[].forEach.call($(".subgroup"),function(a){a.classList.remove("over");$(a).hide()});"QUERY_BUILDER"===activeTab?$(builderSubgroup).hide():"SET_BUILDER"===activeTab&&$(setBuilderSubgroup).hide();$(getSubgroup(draggingFromGroup)).hide();printToJSON()}
function handleDropIntoGroup(a){a.stopPropagation&&a.stopPropagation();a=dragSourceEl.parentElement;if(a!=this){var b=getLastChildWithClassnameIndexFromElement("expression",this),d;if(-1!=b){this.insertBefore(dragSourceEl,this.children[b].nextSibling);var c=getKeywordIndexFromElement(this.children[b]);-1!=c&&(d=this.children[b].children[c].value)}else this.insertBefore(dragSourceEl,this.firstChild);d&&(b=getKeywordIndexFromElement(dragSourceEl),-1!=b&&(dragSourceEl.children[b].value=d));cleanUpKeywords(a);
cleanUpKeywordGroups(a);cleanUpKeywords(this)}$(getSubgroup(this)).hide();return!1}
function handleDropIntoSubgroup(a){a.stopPropagation&&a.stopPropagation();var b=dragSourceEl.parentElement;a=this.parentElement;var d=createGroup();d.insertBefore(dragSourceEl,d.firstChild);var c=getLastExpressionOrGroupIndexFromGroup(a);-1!=c?a.insertBefore(d,a.children[c].nextSibling):a.insertBefore(d,a.firstChild);cleanUpKeywords(b);cleanUpKeywordGroups(b);cleanUpKeywords(a);cleanUpKeywordGroups(a);cleanUpKeywords(d);$(this).hide();-1!==c&&$(a).hasClass("builderAll")&&(b=encapsulateFromIndexToIndexInNewGroup(a,
0,1),$(a).prepend(b));return!1}function handleClickGroup(a){"QUERY_BUILDER"===activeTab?($(selectedGroup).removeClass("selectedGroup"),selectedGroup=this,$(selectedGroup).addClass("selectedGroup")):"SET_BUILDER"===activeTab&&($(selectedSetGroup).removeClass("selectedGroup"),selectedSetGroup=this,$(selectedSetGroup).addClass("selectedGroup"))}
function addDragListeners(a){a.addEventListener("dragstart",handleDragStart,!1);a.addEventListener("dragover",handleDragOver,!1);a.addEventListener("dragenter",handleDragEnter,!1);a.addEventListener("dragleave",handleDragLeave,!1);a.addEventListener("drop",handleDrop,!1);a.addEventListener("dragend",handleDragEnd,!1)}
function addGroupDragListeners(a){a.addEventListener("dragover",handleDragOver,!1);a.addEventListener("dragenter",handleDragEnter,!0);a.addEventListener("dragleave",handleDragLeave,!1);a.addEventListener("drop",handleDropIntoGroup,!1);a.addEventListener("click",handleClickGroup,!0)}
function addSubgroupDragListeners(a){a.addEventListener("dragover",handleDragOver,!1);a.addEventListener("dragenter",handleDragEnter,!1);a.addEventListener("dragleave",handleDragLeave,!1);a.addEventListener("drop",handleDropIntoSubgroup,!0)}
function addOnchangeMethodsToDatepickerElement(a){$(a).on("changed.fu.datepicker dateClicked.fu.datepicker",function(a,d){a=this.parentElement.parentElement;d=a.parentElement.parentElement;void 0!=d&&null!=d.expressionIndex&&backboneExpressions.at(d.expressionIndex).set("value",$(getValueDateInputFromExpression(a))[0].value);$queryJSON.val(printAll())});$(getValueDateInputFromExpression(a.parentElement.parentElement)).change(function(){var b=a.parentElement.parentElement,d=b.parentElement.parentElement;
void 0!=d&&null!=d.expressionIndex&&backboneExpressions.at(d.expressionIndex).set("value",$(getValueDateInputFromExpression(b))[0].value);$queryJSON.val(printAll())})}function encapsulateFromIndexToIndexInNewGroup(a,b,d){for(var c=createGroup();d>=b;d--)if($(a.children[d]).hasClass("expression")||$(a.children[d]).hasClass("group"))c.firstChild?c.insertBefore(a.children[d],c.firstChild):c.appendChild(a.children[d]);return c}
function createGroup(){var a=document.createElement("div");a.className="group";editable&&addButtonRemove(a,"removeGroup");editable&&addGroupDragListeners(a);addSubgroup(a);return a}function addButtonRemove(a,b){var d=document.createElement("button"),c=document.createTextNode("x");d.appendChild(c);d.className=b+" btn btn-default btn-xs";a.appendChild(d)}
function addKeyword(a,b,d){var c=document.createElement("select"),e=document.createElement("option");"QUERY_BUILDER"==activeTab?(e.text="and",c.add(e),e=document.createElement("option"),e.text="or",c.add(e),$(c).val(b)):"SET_BUILDER"===activeTab&&(e.text="intersect",c.add(e),e=document.createElement("option"),e.text="union",c.add(e),e=document.createElement("option"),e.text="minus",c.add(e),$(c).val(b),c.classList.add("extra-width"));c.classList.add(d);c.classList.add("form-control");a.appendChild(c);
editable||(c.disabled="disabled")}function addSubgroup(a){var b=document.createElement("div");b.className="subgroup";editable&&addSubgroupDragListeners(b);$(b).hide();a.appendChild(b)}
function addShowRLDS(a,b,d){var c=document.getElementById("reassessListednessDS");$("#reassessListednessDSSelect").select2("destroy");c=c.cloneNode(!0);$("#reassessListednessDSSelect").select2();$(c).removeAttr("id");var e=getExtraValueRLDSSelectFromContainer(c);b&&$(e).val(b.split(";"));$(e).select2();$(getExtraValues(a)).append(c);editable||(e.disabled="disabled");d!=REASSESS_LISTEDNESS_FIELD_J&&d!=REASSESS_LISTEDNESS_FIELD||1==$(getExtraValues(a))[0].childElementCount?$(c).show():$(c).hide()}
function cleanUpKeywordGroups(a){for(var b=0,d=-1,c=0;c<a.children.length;c++)$(a.children[c]).hasClass("group")&&(b++,d=c);0<b&&(c=getKeywordIndexFromElement(a.children[d]),-1<c&&$(a.children[d].children[c]).remove());if(0<b){c=getKeywordIndexFromElement(a.children[d]);-1<c&&$(a.children[d].children[c]).remove();for(var c=-1,e=0;-1==c;)$(a.children[e]).hasClass("group")?c=e:e++;e=getKeywordIndexFromElement(a.children[c]);if(-1==e)if(2==b)"QUERY_BUILDER"===activeTab?addKeyword(a.children[c],"and",
"keywordGroup"):"SET_BUILDER"===activeTab&&addKeyword(a.children[c],"intersect","keywordGroup");else if(2<b){var h=getKeywordIndexFromElement(a.children[c].nextSibling);addKeyword(a.children[c],$(a.children[c].nextSibling.children[h]).val(),"keywordGroup")}2<b&&-1==getKeywordIndexFromElement(a.children[d-1])&&addKeyword(a.children[d-1],$(a.children[c].children[e]).val(),"keywordGroup")}else c=getKeywordIndexFromElement(a),-1<c&&-1!=d&&$(a.children[d].children[c]).remove()}
function cleanUpKeywords(a){var b=getLastChildWithClassnameIndexFromElement("expression",a),d=getFirstChildWithClassnameIndexFromElement("group",a);if(-1<b){var c=$(a.children[b]).find(".keywordExpression");0!=c.length&&-1==d&&$(c[0]).remove();1==b?0==$(a.children[0]).find(".keywordExpression").length&&("QUERY_BUILDER"===activeTab?addKeyword(a.children[0],"and","keywordExpression"):"SET_BUILDER"===activeTab&&addKeyword(a.children[0],"intersect","keywordExpression")):1<b&&0==$(a.children[b-1]).find(".keywordExpression").length&&
addKeyword(a.children[b-1],$($(a.children[0]).find(".keywordExpression")[0]).val(),"keywordExpression");-1!=d&&0==c.length&&($(a.children[0]).find(".keywordExpression")[0]?addKeyword(a.children[b],$($(a.children[0]).find(".keywordExpression")[0]).val(),"keywordExpression"):"QUERY_BUILDER"===activeTab?addKeyword(a.children[b],"and","keywordExpression"):"SET_BUILDER"===activeTab&&addKeyword(a.children[b],"intersect","keywordExpression"))}}
function createExpressionFromInput(a,b,d,c,e){var h=c;if($.isArray(c))for(var h="",f=0;f<c.length;f++)h=0!=f?h+(";"+c[f]):h+c[f];h=new Expression({field:b,op:d,value:h});if(RLDS_KEY in e){e=e[RLDS_KEY];$(getExtraValueRLDSSelectFromContainer(a)).val(e);var g=e;if($.isArray(e))for(g="",f=0;f<e.length;f++)g=0!=f?g+(";"+e[f]):g+e[f];h.set(RLDS_KEY,g)}backboneExpressions.add(h);f=document.createElement("div");$(getFieldFromExpression(a)).val(b);$(getOperatorFromExpression(a)).val(d);b=getDestroyedSelectValueFromContainer(a);
$(b).val(c);f.appendChild(a);editable&&addButtonRemove(f,"removeExpression");f.className="expression";editable&&(f.draggable=!0,addDragListeners(f));f.expressionIndex=backboneExpressions.indexOf(h);return f}
function createSetExpressionFromInput(a,b){var d=new Expression({query:b});backboneSets.add(d);var c=document.createElement("div"),e=getDestroyedQuerySelectValueFromContainer(a);$(e).val(b);c.appendChild(a);editable&&addButtonRemove(c,"removeExpression");c.className="expression";editable&&(c.draggable=!0,addDragListeners(c));c.expressionIndex=backboneSets.indexOf(d);return c}
function setActiveTabSet(){$queryBuilder.removeClass("active");$queryBuilderTab.removeClass("active");$setBuilder.addClass("active");$setBuilderTab.addClass("active")}function setActiveTabCustom(){$queryBuilder.removeClass("active");$queryBuilderTab.removeClass("active");$customSQL.addClass("active");$customSQLTab.addClass("active")}function disableTabLink(a){a.removeAttr("data-toggle");a.addClass("noClick")}
function getDestroyedSelectValueFromContainer(a){var b=$(getFieldFromExpression(a)).select2("val")[0].value,d=getFieldType($(getFieldFromExpression(a)).find(":selected")),c=$(getOperatorFromExpression(a))[0].value;if($(a).find(".rptFieldInput").is(":checked"))return getReportFiledSelectFromExpression(a);if(!_.has(copyAndPastesFields,b)&&!$(a).find(".poiInput").is(":checked")){if(d==RF_TYPE_DATE)return getValueDateFromExpression(a);if(d==RF_TYPE_STRING){if(_.contains(EQUALS_OPERATORS,c))return getValueSelectFromExpression(a)}else if(d==
RF_TYPE_AUTOCOMPLETE&&_.contains(EQUALS_OPERATORS,c))return getValueSelectAutoFromExpression(a)}return getValueTextFromExpression(a)}function getDestroyedQuerySelectValueFromContainer(a){return getQueryFromExpression(a)}
function getCorrectSelectValueFromContainer(a){var b=$(getFieldFromExpression(a)).select2("val"),d=getFieldType($(getFieldFromExpression(a)).find(":selected")),c=$(getOperatorFromExpression(a))[0].value;if($(a).find(".rptFieldInput").is(":checked"))return getReportFiledSelectFromExpression(a);if(!(_.has(copyAndPastesFields,b)||$(a).find(".poiInput").is(":checked")||getReportFieldDicType())){if(d==RF_TYPE_DATE)return getValueDateFromExpression(a);if(d==RF_TYPE_STRING){if(_.contains(EQUALS_OPERATORS,
c))return getValueSelectFromExpression(a)}else if(d==RF_TYPE_AUTOCOMPLETE&&_.contains(EQUALS_OPERATORS,c))return getValueSelectAutoFromExpression(a)}return getValueTextFromExpression(a)}
function showHideValue(a,b){switch(a){case EDITOR_TYPE_DATE:$(getValueTextFromExpression(b).parentElement).hide();$(getValueSelectFromExpression(b).parentElement).hide();$(getValueSelectAutoFromExpression(b).parentElement).hide();$(getValueDateFromExpression(b).parentElement).show();$(getReportFiledSelectFromExpression(b).parentElement).hide();break;case EDITOR_TYPE_SELECT:$(getValueTextFromExpression(b).parentElement).hide();$(getValueSelectFromExpression(b).parentElement).show();$(getValueSelectAutoFromExpression(b).parentElement).hide();
$(getValueDateFromExpression(b).parentElement).hide();$(getReportFiledSelectFromExpression(b).parentElement).hide();break;case EDITOR_TYPE_AUTOCOMPLETE:$(getValueTextFromExpression(b).parentElement).hide();$(getValueSelectFromExpression(b).parentElement).hide();$(getValueSelectAutoFromExpression(b).parentElement).show();$(getValueDateFromExpression(b).parentElement).hide();$(getReportFiledSelectFromExpression(b).parentElement).hide();break;case EDITOR_TYPE_NONE:$(getValueTextFromExpression(b).parentElement).hide();
$(getValueSelectFromExpression(b).parentElement).hide();$(getValueSelectAutoFromExpression(b).parentElement).hide();$(getValueDateFromExpression(b).parentElement).hide();$(getReportFiledSelectFromExpression(b).parentElement).hide();break;case EDITOR_TYPE_RPT_FIELD:$(getValueTextFromExpression(b).parentElement).hide();$(getValueSelectFromExpression(b).parentElement).hide();$(getValueSelectAutoFromExpression(b).parentElement).hide();$(getValueDateFromExpression(b).parentElement).hide();$(getReportFiledSelectFromExpression(b).parentElement).show();
break;default:$(getValueTextFromExpression(b).parentElement).show(),$(getValueSelectFromExpression(b).parentElement).hide(),$(getValueSelectAutoFromExpression(b).parentElement).hide(),$(getValueDateFromExpression(b).parentElement).hide(),$(getReportFiledSelectFromExpression(b).parentElement).hide()}}function getFieldFromExpression(a){return $(a).find("select.expressionField")[0]}function getOperatorFromExpression(a){return $(a).find(".expressionOp")[0]}
function getValueTextFromExpression(a){return $(a).find(".expressionValueText")[0]}function getFieldIsValidatableFromExpression(a){return"true"==$(getFieldFromExpression(a)).find("option:selected").attr("data-validatable")}function getPOICheckBoxFromExpression(a){return $(a).find(".poiInput")[0]}function getRptInputCheckBoxFromExpression(a){return $(a).find(".rptFieldInput")[0]}function getValueSelectFromExpression(a){a=$(a).find(".expressionValueSelect");return 1<a.length?a[1]:a[0]}
function getValueSelectAutoFromExpression(a){a=$(a).find(".expressionValueSelectAuto");return 1<a.length?a[1]:a[0]}function getExtraValues(a){return $(a).find(".extraValues")}function getExtraValueRLDSSelectFromContainer(a){return $(a).find("select.reassessListednessDS")}function getValueDateFromExpression(a){return $(a).find(".expressionValueDate")[0]}function getValueDateInputFromExpression(a){return $(a).find(".expressionValueDateInput")[0]}
function getReportFiledSelectFromExpression(a){return $(a).find(".expressionValueRptField")[0]}function getFieldType(a){var b="";if(a.data("isautocomplete"))b=RF_TYPE_AUTOCOMPLETE;else switch(a.data("datatype")){case "java.lang.String":b=a.data("istext")?RF_TYPE_TEXT:RF_TYPE_STRING;break;case "java.util.Date":b=RF_TYPE_DATE;break;case "java.lang.Number":b=RF_TYPE_NUMBER;break;case "com.rxlogix.config.PartialDate":b=RF_TYPE_PART_DATE}return b}
function getChildIndexFromParent(a,b){return Array.prototype.indexOf.call(b.children,a)}function getKeywordIndexFromElement(a){for(var b=0;b<a.children.length;b++)if($(a.children[b]).hasClass("keywordExpression")||$(a.children[b]).hasClass("keywordGroup"))return b;return-1}function getFirstChildWithClassnameIndexFromElement(a,b){for(var d=0;d<b.children.length;d++)if($(b.children[d]).hasClass(a))return d;return-1}
function getSecondChildWithClassnameIndexFromElement(a,b){for(var d=!0,c=0;c<b.children.length;c++)if($(b.children[c]).hasClass(a))if(d)d=!1;else return c;return-1}function getLastChildWithClassnameIndexFromElement(a,b){for(var d=-1,c=0;c<b.children.length;c++)$(b.children[c]).hasClass(a)&&(d=c);return d}function getLastExpressionOrGroupIndexFromGroup(a){for(var b=-1,d=0;d<a.children.length;d++)if($(a.children[d]).hasClass("expression")||$(a.children[d]).hasClass("group"))b=d;return b}
function getExpressionOrGroupCountFromGroup(a){for(var b=0,d=0;d<a.children.length;d++)($(a.children[d]).hasClass("expression")||$(a.children[d]).hasClass("group"))&&b++;return b}function getSubgroup(a){for(var b=0;b<a.children.length;b++)if($(a.children[b]).hasClass("subgroup"))return a.children[b];return null}function checkIndexes(a){for(var b=$(document).find(".expression"),d=0;d<b.length;d++)a<b[d].expressionIndex&&b[d].expressionIndex--}
function getQueryFromExpression(a){return $(a).find(".expressionQuery")[0]}function removeEmptyGroups(a){$.each($(a).find(".group"),function(){if(this!==window&&0==$(this).find(".expression").length){var a=this.parentElement;$(this).remove();cleanUpKeywordGroups(a)}})}
function showHideReassessListedness(a,b){var d=!1;$.each($(a).find("select.expressionField"),function(){if($(this).val()==REASSESS_LISTEDNESS_FIELD||$(this).val()==REASSESS_LISTEDNESS_FIELD_J)d=!0});b&&(d=!0);d?$("#extraOptions").show():$("#extraOptions").hide()}$("#mainContent").on("change","#name",function(){0<$(this).val().trim().length&&$("#name").parent().removeClass("has-error")});
function sendReassessListedness(){var a=$("#reassessListedness");"QUERY_BUILDER"===activeTab&&a.is(":visible")||a.removeAttr("name")}function finalizeForm(){if(!checkAllNumberFields())return!1;sendReassessListedness();"QUERY_BUILDER"===activeTab?($("#setJSON").removeAttr("name"),removeEmptyGroups(builderAll)):"SET_BUILDER"===activeTab&&($("#queryJSON").removeAttr("name"),$("#hasBlanksQuery").val("false"),removeEmptyGroups(setBuilderAll));printToJSON();return!0}
function bindQuerySelect2(a){return bindSelect2WithUrl(a,querySearchUrl,queryNameUrl,!1)}function checkNumberFields(a,b){var d=!0;$.isNumeric(a)&&(isPositiveInteger(a)?$(b).find(".errorMessageOperator").hide():(d=!1,$(b).find(".errorMessageOperator").show()));return d}
function checkAllNumberFields(){var a=!0;$.each($(".builderAll #selectValue"),function(){-1<$(this).parents().eq(3).find("#selectOperator")[0].value.search("LAST_X")&&$.isNumeric(this.value)&&(isPositiveInteger(this.value)?$(this).parents().eq(2).find(".errorMessageOperatorInline").hide():(a=!1,$(this).parents().eq(2).find(".errorMessageOperatorInline").show()))});return a}function showPOIInputParameter(a){showHideValue(EDITOR_TYPE_TEXT,a)}function isSpecialKeyValue(a){return a&&a.match(/^\&/)}
function isReportFieldKeyValue(a){return a&&a.match(/^\#_/)}function showWarning(a){$("form#queryForm").attr("action",a);$("#warningModal .description").text($.i18n._("query.edit.warning"));$("#warningModal").modal("show");$("#warningButton").unbind("click").click(function(){finalizeForm()&&$("#warningButton").attr("disabled",!0);$("form#queryForm").submit()})};