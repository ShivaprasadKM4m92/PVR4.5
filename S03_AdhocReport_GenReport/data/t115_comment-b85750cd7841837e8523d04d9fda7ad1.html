//# sourceMappingURL=comment.js.map
$(document).ready(function(){var a=new CommentDialog("","",$("#appContext").val(),$("#commentsList"),$('form[name="annotationForm"]'));$(".commentModalTrigger").on("click",function(c){a.ownerId=this.getAttribute("data-owner-id");a.commentType=this.getAttribute("data-comment-type");a.triggerPoint=$(this).find(".annotationPopover i");hideCommentForm();$("input[name='ownerId']").val(a.ownerId);$("input[name='commentType']").val(a.commentType);$("#commentsTitle").text($("input[name='"+a.commentType+"']").val());
a.reloadComments()});$(".saveComment").on("click",function(){a.save()});$(".hideCommentForm").on("click",function(){hideCommentForm()});bindPopOverEvents($(".commentPopoverMessage"))});
function CommentDialog(a,c,d,e,f,g){this.ownerId=a;this.commentType=c;this.formObj=f;this.appContext=d;this.commentsToDisplayIn=e;this.triggerPoint=g;this.save=function(){var a=this;$.ajax({url:a.appContext+"/commentRest/save",method:"POST",data:a.formObj.serialize(),success:function(b){b.success?(a.reloadComments(),a.resetForm(),changeAnnotationIcon(a.triggerPoint,!1)):(void 0!=b.errors&&$.each(b.errors,function(b,c){b=a.formObj.find('[name="'+c+'"]');void 0!=b&&b.parent().addClass("has-error")}),
0==a.formObj.find(".has-error").size()&&alert(b.msg))},error:function(){alert("Sorry! System level error")}})};this.delete=function(a){var b=this;$.ajax({url:this.appContext+"/commentRest/delete",data:{ownerId:this.ownerId,commentType:this.commentType,"comment.id":a},method:"POST",success:function(a){a.success?(b.reloadComments(),a.isCommentListEmpty&&changeAnnotationIcon(b.triggerPoint,!0)):alert(a.msg)},error:function(){alert("Sorry! System level error")}})};this.reloadComments=function(){var a=
this;$.ajax({url:this.appContext+"/commentRest/loadComments",data:{ownerId:this.ownerId,commentType:this.commentType},method:"POST",success:function(b){a.commentsToDisplayIn.html(b);a.commentsToDisplayIn.find(".delete").on("click",function(b){a.delete($(this).data("id"))})},error:function(){alert("Sorry! System level error")}})};this.resetForm=function(){this.formObj.find(".has-error").removeClass("has-error");this.formObj.find("textArea").val("")}}
function changeAnnotationIcon(a,c){c?(a.removeClass("fa-commenting-o commentPopoverMessage"),a.addClass("fa-comment-o")):a.hasClass("fa-comment-o")&&(a.removeClass("fa-comment-o"),a.addClass("fa-commenting-o commentPopoverMessage"),bindPopOverEvents(a))}function hideCommentForm(){var a=$("#commentModal");a.find("div.add-comment-component").hide();a.find("div.btn-add-comment").show()}
function showCommentForm(){var a=$("#commentModal");a.find("div.add-comment-component").show();a.find("div.btn-add-comment").hide()}
function updatePopoverWithLatestComment(a){var c=$(a),d=c.parent().parent();a=d.attr("data-owner-id");d=d.attr("data-comment-type");$.ajax({url:$("#appContext").val()+"/commentRest/loadLatestComment",data:{ownerId:a,commentType:d},method:"POST",success:function(a){c.attr("data-content",a);c.data("bs.popover").setContent()},error:function(){alert("Sorry! System level error")}})}
function bindPopOverEvents(a){a.popover({trigger:"hover focus",html:!0});a.on("show.bs.popover",function(){updatePopoverWithLatestComment(this)})};